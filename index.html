<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Monitoramento de Som - Salas</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body { font-family: Arial; text-align:center; background:#f5f5f5; }
.mapa-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:20px; max-width:900px; margin:auto; }
.sala { padding:20px; border-radius:10px; color:white; font-size:22px; font-weight:bold; }
.db-resumo { font-size:32px; margin-top:10px; }
.sala-verde { background:#2ecc71; }
.sala-amarela { background:#f1c40f; }
.sala-vermelha { background:#e74c3c; }
.sala-carregando { background:#95a5a6; }
</style>
</head>
<body>

<h1>Monitoramento em Tempo Real ðŸ“¡</h1>
<p>Clique em uma sala para detalhes</p>

<div class="mapa-grid">

<div class="sala sala-carregando" id="Sala_1">
    Sala 1
    <div class="db-resumo" id="db-Sala_1">--</div>
</div>

<div class="sala sala-carregando" id="Sala_2">
    Sala 2
    <div class="db-resumo" id="db-Sala_2">--</div>
</div>

<div class="sala sala-carregando" id="Sala_3">
    Sala 3
    <div class="db-resumo" id="db-Sala_3">--</div>
</div>

</div>

<script>

// CONFIG FIREBASE
const firebaseConfig = {
    apiKey: "yBe1k678KMGvygizrLbMLNkQzRYsWF0umQP3T693",
    databaseURL: "https://mapasesom2025-default-rtdb.firebaseio.com",
    projectId: "mapasesom2025"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

function cor(db){
    if(db > 70) return "sala-vermelha";
    if(db >= 50) return "sala-amarela";
    return "sala-verde";
}

["Sala_1","Sala_2","Sala_3"].forEach(sala => {

    const ref = db.ref("leituras/"+sala).limitToLast(1);

    ref.on("value", snap => {

        const data = snap.val();
        if(!data) return;

        const key = Object.keys(data)[0];
        const registro = data[key];
        const dbValue = registro.db;

        document.getElementById("db-"+sala).innerText = dbValue.toFixed(1)+" dB";

        const salaDiv = document.getElementById(sala);
        salaDiv.className = "sala " + cor(dbValue);
    });

});

</script>

</body>
</html>
